cmake_minimum_required(VERSION 3.2 FATAL_ERROR)

# Retrieves the version numbers from "include/mantella", avoiding possible inconsistency.
file(GLOB MANTELLA_HEADER_FILE "../include/mantella*")
string(REGEX REPLACE ".*/include/mantella([0-9]+).*" "\\1" MANTELLA_VERSION_MAJOR "${MANTELLA_HEADER_FILE}")
file(STRINGS ../include/mantella${MANTELLA_VERSION_MAJOR} MANTELLA_HEADER_CONTENTS REGEX "#define MANTELLA_VERSION_[A-Z]+ ")
string(REGEX REPLACE ".*#define MANTELLA_VERSION_MINOR ([0-9]+).*" "\\1" MANTELLA_VERSION_MINOR "${MANTELLA_HEADER_CONTENTS}")
string(REGEX REPLACE ".*#define MANTELLA_VERSION_PATCH ([0-9]+).*" "\\1" MANTELLA_VERSION_PATCH "${MANTELLA_HEADER_CONTENTS}")
set(MANTELLA_VERSION "${MANTELLA_VERSION_MAJOR}.${MANTELLA_VERSION_MINOR}.${MANTELLA_VERSION_PATCH}")

project(BenchmarkMantella VERSION ${MANTELLA_VERSION} LANGUAGES CXX)

message(STATUS "") 
message(STATUS "Configuring benchmark for Mantella (version: ${MANTELLA_VERSION}).")

configure_file(${PROJECT_SOURCE_DIR}/main.cpp.cmake ${PROJECT_SOURCE_DIR}/main.cpp)
add_executable(tests main.cpp)
set_property(TARGET tests PROPERTY CXX_STANDARD 14)
set_property(TARGET tests PROPERTY CXX_STANDARD_REQUIRED ON)

target_include_directories(tests PRIVATE "../include")

#
# Prints noticeable variables
#

message(STATUS "")
message(STATUS "Noticable variables:")
message(STATUS "- CMAKE_PREFIX_PATH = ${CMAKE_PREFIX_PATH}")
message(STATUS "- CMAKE_BUILD_TYPE = ${CMAKE_BUILD_TYPE}")
message(STATUS "- CMAKE_RUNTIME_OUTPUT_DIRECTORY = ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}")
message(STATUS "")
